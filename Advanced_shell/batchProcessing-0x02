#!/bin/bash

# Create output directory if it doesn't exist
mkdir -p pokemon_data

# Error log file
ERROR_LOG="errors.log"
> "$ERROR_LOG"  # Clear previous errors

# List of Pokémon
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Loop through each Pokémon
for name in "${pokemon_list[@]}"; do
  echo "Fetching data for $name..."
  
  success=false
  attempt=1
  max_retries=3

  while [ $attempt -le $max_retries ]; do
    response=$(curl -s -w "%{http_code}" -o "pokemon_data/${name}.json" "https://pokeapi.co/api/v2/pokemon/$name")
    
    if [ "$response" -eq 200 ]; then
      echo "Saved data to pokemon_data/${name}.json "
      success=true
      break
    else
      echo "Attempt $attempt failed for $name (Status: $response)"
      ((attempt++))
      sleep 2  # Delay between retries
    fi
  done

  if ! $success; then
    echo "Failed to fetch data for $name after $max_retries attempts." | tee -a "$ERROR_LOG"
    rm -f "pokemon_data/${name}.json"
  fi

  sleep 2  # Rate-limiting pause between Pokémon
done
