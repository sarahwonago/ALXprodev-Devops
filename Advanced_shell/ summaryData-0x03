#!/bin/bash

# Set the output CSV file
CSV_FILE="pokemon_report.csv"

# Create or clear the CSV file
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Loop through all JSON files in pokemon_data/
for file in pokemon_data/*.json; do
  # Extract data using jq
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height=$(jq '.height' "$file" | awk '{ printf "%.2f", $1 / 10 }')
  weight=$(jq '.weight' "$file" | awk '{ printf "%.1f", $1 / 10 }')

  # Append to CSV
  echo "$name,$height,$weight" >> "$CSV_FILE"
done

# Display success message
echo "CSV Report generated at: $CSV_FILE"
echo ""

# Print the CSV
cat "$CSV_FILE"

echo ""

# Calculate averages with awk
awk -F, 'NR > 1 {
  h += $2
  w += $3
  count++
}
END {
  if (count > 0) {
    printf "Average Height: %.2f m\n", h / count
    printf "Average Weight: %.2f kg\n", w / count
  }
}' "$CSV_FILE"
